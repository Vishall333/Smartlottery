
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Smart Lottery Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://sdk.cashfree.com/js/ui/2.0.0/cashfree.prod.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <style>
        :root {
            --primary: #1a237e;
            --primary-light: #534bae;
            --primary-dark: #000051;
            --secondary: #1976d2;
            --success: #388e3c;
            --error: #d32f2f;
            --gold: #ffa000;
            --dark: #121212;
            --light: #f5f5f5;
            --text: #212121;
            --text-light: #757575;
            --white: #ffffff;
            --shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            --shadow-hover: 0 2px 6px rgba(0, 0, 0, 0.15);
            --radius: 8px;
            --radius-sm: 4px;
            --transition: all 0.2s ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--light);
            color: var(--text);
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
            touch-action: manipulation;
        }
        
        h1, h2, h3, h4 {
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
        }
        
        .app-container {
            min-height: 100vh;
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
            color: var(--white);
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(45deg, var(--gold), #fff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .contest-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .contest-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: var(--radius);
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: var(--transition);
        }
        
        .contest-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
        }
        
        .contest-title {
            font-size: 1.25rem;
            margin-bottom: 10px;
            color: var(--gold);
        }
        
        .contest-prize {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 15px;
        }
        
        .contest-details {
            margin-bottom: 20px;
        }
        
        .contest-details p {
            margin-bottom: 5px;
            opacity: 0.8;
        }
        
        .join-btn {
            width: 100%;
            padding: 12px 20px;
            background: linear-gradient(45deg, var(--success), var(--secondary));
            color: var(--white);
            border: none;
            border-radius: var(--radius-sm);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .join-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
        }
        
        .wallet-section {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: var(--radius);
            margin-bottom: 30px;
            text-align: center;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .balance {
            font-size: 2rem;
            font-weight: 700;
            color: var(--gold);
            margin-bottom: 15px;
        }
        
        .add-money-btn {
            padding: 10px 20px;
            background: var(--gold);
            color: var(--dark);
            border: none;
            border-radius: var(--radius-sm);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
        }
        
        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--white);
            color: var(--text);
            padding: 30px;
            border-radius: var(--radius);
            max-width: 400px;
            width: 90%;
        }
        
        .modal h3 {
            margin-bottom: 20px;
            color: var(--primary);
        }
        
        .amount-input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: var(--radius-sm);
            margin-bottom: 20px;
            font-size: 1rem;
        }
        
        .payment-btn {
            width: 100%;
            padding: 12px;
            background: var(--primary);
            color: var(--white);
            border: none;
            border-radius: var(--radius-sm);
            font-weight: 600;
            cursor: pointer;
        }
        
        .close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-light);
        }
        
        .auth-section {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .auth-btn {
            margin: 0 10px;
            padding: 10px 20px;
            background: var(--secondary);
            color: var(--white);
            border: none;
            border-radius: var(--radius-sm);
            cursor: pointer;
        }
        
        .user-info {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .logout-btn {
            background: var(--error);
            color: var(--white);
            border: none;
            padding: 8px 16px;
            border-radius: var(--radius-sm);
            cursor: pointer;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="header">
            <h1>ðŸŽ¯ Smart Lottery Pro</h1>
            <p>Win Big, Play Smart, Live Rich!</p>
        </div>

        <!-- Authentication Section -->
        <div id="authSection" class="auth-section">
            <button id="loginBtn" class="auth-btn">Login</button>
            <button id="signupBtn" class="auth-btn">Sign Up</button>
        </div>

        <!-- User Info Section -->
        <div id="userSection" class="user-info" style="display: none;">
            <span id="userEmail"></span>
            <button id="logoutBtn" class="logout-btn">Logout</button>
        </div>

        <!-- Wallet Section -->
        <div id="walletSection" class="wallet-section" style="display: none;">
            <div class="balance">â‚¹<span id="userBalance">0</span></div>
            <button id="addMoneyBtn" class="add-money-btn">Add Money</button>
        </div>

        <!-- Contests Grid -->
        <div id="contestsGrid" class="contest-grid" style="display: none;"></div>
    </div>

    <!-- Add Money Modal -->
    <div id="addMoneyModal" class="modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeModal()">&times;</button>
            <h3>Add Money to Wallet</h3>
            <input type="number" id="amountInput" class="amount-input" placeholder="Enter amount (â‚¹)" min="10" max="50000">
            <button id="payNowBtn" class="payment-btn">Pay with Cashfree</button>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBXeD8SMXHnqhNDg01Rlm4fC1t05Eb4NFs",
            authDomain: "smart-lottery-b08c5.firebaseapp.com",
            projectId: "smart-lottery-b08c5",
            storageBucket: "smart-lottery-b08c5.appspot.com",
            messagingSenderId: "1038545058004",
            appId: "1:1038545058004:web:65b29c57eda2939f18e341",
            measurementId: "G-SH9Y19ZE74"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        let currentUser = null;
        let userBalance = 0;

        // Sample contests data
        const contests = [
            {
                id: 1,
                title: "Daily Flash Draw - 7 PM",
                prize: "â‚¹10,000",
                entryFee: 50,
                participants: 145,
                maxParticipants: 200,
                timeLeft: "2h 15m"
            },
            {
                id: 2,
                title: "Mega Monday Jackpot",
                prize: "â‚¹50,000",
                entryFee: 100,
                participants: 89,
                maxParticipants: 500,
                timeLeft: "6h 30m"
            },
            {
                id: 3,
                title: "Weekend Special",
                prize: "â‚¹25,000",
                entryFee: 75,
                participants: 234,
                maxParticipants: 300,
                timeLeft: "1d 4h"
            },
            {
                id: 4,
                title: "Quick Win Express",
                prize: "â‚¹5,000",
                entryFee: 25,
                participants: 67,
                maxParticipants: 100,
                timeLeft: "45m"
            }
        ];

        // Authentication functions
        function showLogin() {
            const email = prompt("Enter your email:");
            const password = prompt("Enter your password:");
            
            if (email && password) {
                auth.signInWithEmailAndPassword(email, password)
                    .then((userCredential) => {
                        console.log("User logged in:", userCredential.user);
                    })
                    .catch((error) => {
                        alert("Login failed: " + error.message);
                    });
            }
        }

        function showSignup() {
            const email = prompt("Enter your email:");
            const password = prompt("Enter your password (min 6 characters):");
            
            if (email && password) {
                auth.createUserWithEmailAndPassword(email, password)
                    .then((userCredential) => {
                        console.log("User created:", userCredential.user);
                        // Initialize user balance in Firestore
                        db.collection('users').doc(userCredential.user.uid).set({
                            email: email,
                            balance: 0,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                    })
                    .catch((error) => {
                        alert("Signup failed: " + error.message);
                    });
            }
        }

        function logout() {
            auth.signOut().then(() => {
                console.log("User logged out");
            });
        }

        // UI functions
        function updateUI(user) {
            if (user) {
                currentUser = user;
                document.getElementById('authSection').style.display = 'none';
                document.getElementById('userSection').style.display = 'block';
                document.getElementById('walletSection').style.display = 'block';
                document.getElementById('contestsGrid').style.display = 'grid';
                document.getElementById('userEmail').textContent = user.email;
                
                loadUserBalance();
                renderContests();
            } else {
                currentUser = null;
                document.getElementById('authSection').style.display = 'block';
                document.getElementById('userSection').style.display = 'none';
                document.getElementById('walletSection').style.display = 'none';
                document.getElementById('contestsGrid').style.display = 'none';
            }
        }

        function loadUserBalance() {
            if (currentUser) {
                db.collection('users').doc(currentUser.uid).get()
                    .then((doc) => {
                        if (doc.exists) {
                            userBalance = doc.data().balance || 0;
                            document.getElementById('userBalance').textContent = userBalance;
                        }
                    })
                    .catch((error) => {
                        console.error("Error loading balance:", error);
                    });
            }
        }

        function renderContests() {
            const grid = document.getElementById('contestsGrid');
            grid.innerHTML = '';
            
            contests.forEach(contest => {
                const card = document.createElement('div');
                card.className = 'contest-card';
                card.innerHTML = `
                    <div class="contest-title">${contest.title}</div>
                    <div class="contest-prize">${contest.prize}</div>
                    <div class="contest-details">
                        <p>Entry Fee: â‚¹${contest.entryFee}</p>
                        <p>Participants: ${contest.participants}/${contest.maxParticipants}</p>
                        <p>Time Left: ${contest.timeLeft}</p>
                    </div>
                    <button class="join-btn" onclick="joinContest(${contest.id}, ${contest.entryFee})">
                        Join Contest - â‚¹${contest.entryFee}
                    </button>
                `;
                grid.appendChild(card);
            });
        }

        function joinContest(contestId, entryFee) {
            if (!currentUser) {
                alert("Please login first");
                return;
            }
            
            if (userBalance < entryFee) {
                alert("Insufficient balance. Please add money to your wallet.");
                return;
            }
            
            // Deduct entry fee and join contest
            const newBalance = userBalance - entryFee;
            
            db.collection('users').doc(currentUser.uid).update({
                balance: newBalance
            }).then(() => {
                // Record contest entry
                db.collection('contestEntries').add({
                    userId: currentUser.uid,
                    contestId: contestId,
                    entryFee: entryFee,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                userBalance = newBalance;
                document.getElementById('userBalance').textContent = userBalance;
                alert("Successfully joined the contest!");
            }).catch((error) => {
                console.error("Error joining contest:", error);
                alert("Failed to join contest. Please try again.");
            });
        }

        function openAddMoneyModal() {
            document.getElementById('addMoneyModal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('addMoneyModal').style.display = 'none';
        }

        async function initiatePayment() {
            const amount = parseInt(document.getElementById('amountInput').value);
            
            if (!amount || amount < 10 || amount > 50000) {
                alert("Please enter a valid amount between â‚¹10 and â‚¹50,000");
                return;
            }

            if (!currentUser) {
                alert("Please login first");
                return;
            }

            try {
                // Create payment document in Firestore
                const paymentRef = await db.collection('payments').add({
                    userId: currentUser.uid,
                    amount: amount,
                    status: 'pending',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });

                // Create Cashfree order
                const response = await fetch("https://your-repl-name.your-username.repl.co/api/cashfree/create-order", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        userId: currentUser.uid,
                        email: currentUser.email,
                        phone: "9876543210", // You might want to collect this from user
                        amount: amount,
                        paymentId: paymentRef.id
                    })
                });

                const data = await response.json();
                
                if (data.payment_session_id) {
                    // Initialize Cashfree payment
                    const cashfree = new Cashfree({
                        mode: "production" // Change to "sandbox" for testing
                    });
                    
                    const checkoutOptions = {
                        paymentSessionId: data.payment_session_id,
                        redirectTarget: "_self"
                    };
                    
                    cashfree.checkout(checkoutOptions).then((result) => {
                        if (result.error) {
                            console.error("Payment failed:", result.error);
                            alert("Payment failed: " + result.error.message);
                        }
                        if (result.redirect) {
                            console.log("Redirecting to payment page");
                        }
                    });
                } else {
                    alert("Failed to initiate payment. Please try again.");
                }
            } catch (error) {
                console.error("Payment error:", error);
                alert("Payment failed. Please try again.");
            }
            
            closeModal();
        }

        // Event listeners
        document.getElementById('loginBtn').addEventListener('click', showLogin);
        document.getElementById('signupBtn').addEventListener('click', showSignup);
        document.getElementById('logoutBtn').addEventListener('click', logout);
        document.getElementById('addMoneyBtn').addEventListener('click', openAddMoneyModal);
        document.getElementById('payNowBtn').addEventListener('click', initiatePayment);

        // Auth state observer
        auth.onAuthStateChanged((user) => {
            updateUI(user);
        });

        // Listen for payment updates
        if (firebase.auth().currentUser) {
            db.collection('payments')
                .where('userId', '==', firebase.auth().currentUser.uid)
                .where('status', '==', 'completed')
                .onSnapshot((snapshot) => {
                    snapshot.docChanges().forEach((change) => {
                        if (change.type === 'added') {
                            const payment = change.doc.data();
                            // Update balance
                            loadUserBalance();
                            alert(`Payment of â‚¹${payment.amount} successful!`);
                        }
                    });
                });
        }

        // Click outside modal to close
        window.onclick = function(event) {
            const modal = document.getElementById('addMoneyModal');
            if (event.target === modal) {
                closeModal();
            }
        }
    </script>
</body>
</html>
